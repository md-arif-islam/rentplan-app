import{q as X,d as Y,r as v,a as e,y as Z,C as h,j as s,B as y,Q as b}from"./index.075fb68b.js";import{S as x}from"./Select.3e0ab40e.js";import{T as d}from"./Textinput.595cc28f.js";import{u as ee}from"./customersApiSlice.4a4014f7.js";import{b as re,d as te}from"./ordersApiSlice.209ba1fa.js";import{u as oe}from"./productsApiSlice.3bd2244e.js";import{c as ie,d as C,e as I,b as se,a as l,u as ae,o as de}from"./array.537130ac.js";const le=ie().shape({customer_id:C().transform(i=>isNaN(i)||i===""?void 0:i).required("Customer is required").typeError("Please select a customer"),product_id:C().transform(i=>isNaN(i)||i===""?void 0:i).required("Product is required").typeError("Please select a product"),start_date:I().required("Start date is required"),end_date:I().required("End date is required").min(se("start_date"),"End date must be after start date"),order_status:l().required("Order status is required"),invoice_street:l().nullable(),invoice_postal_code:l().nullable(),invoice_house_number:l().nullable(),invoice_city:l().nullable(),invoice_country:l().nullable(),delivery_street:l().nullable(),delivery_postal_code:l().nullable(),delivery_house_number:l().nullable(),delivery_city:l().nullable(),delivery_country:l().nullable(),woocommerce_order_id:C().nullable().transform(i=>isNaN(i)||i===""?null:Number(i))}),he=()=>{var $,D,L;const{id:i}=X(),p=Y(),{data:r,isLoading:A,isError:U,error:f}=re(i),[B,{isLoading:Q}]=te(),[T,ce]=v.exports.useState(""),[G,ne]=v.exports.useState(""),[c,S]=v.exports.useState(!1),{data:g,isLoading:H}=ee({search:T,perPage:100}),{data:N,isLoading:M}=oe({search:G,perPage:100}),{register:a,handleSubmit:V,formState:{errors:o},setValue:n,watch:u,reset:E}=ae({resolver:de(le),mode:"onChange",defaultValues:{customer_id:"",product_id:"",start_date:"",end_date:"",order_status:"pending",invoice_street:"",invoice_postal_code:"",invoice_house_number:"",invoice_city:"",invoice_country:"",delivery_street:"",delivery_postal_code:"",delivery_house_number:"",delivery_city:"",delivery_country:"",woocommerce_order_id:""}});v.exports.useEffect(()=>{if(r){E({customer_id:r.customer_id,product_id:r.product_id,start_date:r.start_date?new Date(r.start_date).toISOString().split("T")[0]:"",end_date:r.end_date?new Date(r.end_date).toISOString().split("T")[0]:"",order_status:r.order_status||"pending",invoice_street:r.invoice_street||"",invoice_postal_code:r.invoice_postal_code||"",invoice_house_number:r.invoice_house_number||"",invoice_city:r.invoice_city||"",invoice_country:r.invoice_country||"",delivery_street:r.delivery_street||"",delivery_postal_code:r.delivery_postal_code||"",delivery_house_number:r.delivery_house_number||"",delivery_city:r.delivery_city||"",delivery_country:r.delivery_country||"",woocommerce_order_id:r.woocommerce_order_id||""});const t=r.invoice_street===r.delivery_street&&r.invoice_postal_code===r.delivery_postal_code&&r.invoice_house_number===r.delivery_house_number&&r.invoice_city===r.delivery_city&&r.invoice_country===r.delivery_country;S(t)}},[r,E]);const O=u("invoice_street"),w=u("invoice_postal_code"),P=u("invoice_house_number"),k=u("invoice_city"),q=u("invoice_country");v.exports.useEffect(()=>{c&&(n("delivery_street",O),n("delivery_postal_code",w),n("delivery_house_number",P),n("delivery_city",k),n("delivery_country",q))},[c,O,w,P,k,q,n]);const F=[{value:"pending",label:"Pending"},{value:"processing",label:"Processing"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],W=async t=>{var m,j;try{if(!t.customer_id||isNaN(Number(t.customer_id))){b.error("Please select a valid customer");return}if(!t.product_id||isNaN(Number(t.product_id))){b.error("Please select a valid product");return}t.customer_id=Number(t.customer_id),t.product_id=Number(t.product_id),await B({id:i,...t}).unwrap(),b.success("Order updated successfully"),p("/company/orders")}catch(_){console.error("Update failed",_),(m=_==null?void 0:_.data)!=null&&m.errors?Object.entries(_.data.errors).forEach(([K,R])=>{b.error(`${K}: ${R[0]}`)}):b.error(((j=_==null?void 0:_.data)==null?void 0:j.message)||"Failed to update order")}};if(A||H||M)return e(Z,{});if(U)return e(h,{children:s("div",{className:"flex flex-col items-center justify-center h-60",children:[e("h3",{className:"text-xl font-medium text-slate-900",children:"Error Loading Data"}),e("p",{className:"text-sm text-slate-600 mt-1 mb-4",children:(($=f==null?void 0:f.data)==null?void 0:$.message)||"Could not load order information"}),e(y,{text:"Back to Orders",icon:"heroicons-outline:arrow-left",className:"btn-primary",onClick:()=>p("/company/orders")})]})});const z=((D=g==null?void 0:g.data)==null?void 0:D.map(t=>({value:t.id,label:`${t.first_name} ${t.last_name} (${t.email||"No email"})`})))||[],J=((L=N==null?void 0:N.data)==null?void 0:L.map(t=>({value:t.id,label:`${t.name}`})))||[];return s("div",{className:"space-y-5",children:[s("div",{className:"flex flex-wrap justify-between items-center",children:[s("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:["Edit Order #",i]}),s("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[e(y,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>p("/company/orders")}),e(y,{icon:"heroicons-outline:eye",text:"View",className:"btn-outline-dark",onClick:()=>p(`/company/orders/${i}`)})]})]}),s("form",{onSubmit:V(W),children:[e(h,{title:"Order Information",children:s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[s("div",{children:[e("label",{className:"form-label",children:"Customer *"}),e(x,{options:z,value:u("customer_id"),onChange:t=>{const m=t.target.value;n("customer_id",m?Number(m):"")},error:o.customer_id,noOptionsMessage:()=>"No customers found"}),o.customer_id&&e("div",{className:"text-danger-500 text-sm mt-1",children:o.customer_id.message})]}),s("div",{children:[e("label",{className:"form-label",children:"Product *"}),e(x,{options:J,value:u("product_id"),onChange:t=>{const m=t.target.value;n("product_id",m?Number(m):"")},error:o.product_id,noOptionsMessage:()=>"No products found"}),o.product_id&&e("div",{className:"text-danger-500 text-sm mt-1",children:o.product_id.message})]}),e(d,{label:"Start Date *",type:"date",register:a,name:"start_date",error:o.start_date,placeholder:"Select start date"}),e(d,{label:"End Date *",type:"date",register:a,name:"end_date",error:o.end_date,placeholder:"Select end date"}),s("div",{children:[e("label",{className:"form-label",children:"Status *"}),e(x,{options:F,value:u("order_status"),onChange:t=>n("order_status",t.target.value),error:o.order_status})]}),e(d,{label:"WooCommerce Order ID (Optional)",type:"number",register:a,name:"woocommerce_order_id",error:o.woocommerce_order_id,placeholder:"Enter WooCommerce ID if applicable"})]})}),e(h,{title:"Invoice Address",className:"mt-5",children:s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e(d,{label:"Street",register:a,name:"invoice_street",error:o.invoice_street,placeholder:"Enter street name"}),e(d,{label:"House Number",register:a,name:"invoice_house_number",error:o.invoice_house_number,placeholder:"Enter house number"}),e(d,{label:"Postal Code",register:a,name:"invoice_postal_code",error:o.invoice_postal_code,placeholder:"Enter postal code"}),e(d,{label:"City",register:a,name:"invoice_city",error:o.invoice_city,placeholder:"Enter city"}),e(d,{label:"Country",register:a,name:"invoice_country",error:o.invoice_country,placeholder:"Enter country"})]})}),s(h,{title:"Delivery Address",className:"mt-5",children:[e("div",{className:"mb-5",children:s("label",{className:"inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox rounded text-primary-500 border-slate-300",checked:c,onChange:()=>S(!c)}),e("span",{className:"text-slate-500 dark:text-slate-400 text-sm ml-2",children:"Same as invoice address"})]})}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e(d,{label:"Street",register:a,name:"delivery_street",error:o.delivery_street,disabled:c,placeholder:"Enter street name"}),e(d,{label:"House Number",register:a,name:"delivery_house_number",error:o.delivery_house_number,disabled:c,placeholder:"Enter house number"}),e(d,{label:"Postal Code",register:a,name:"delivery_postal_code",error:o.delivery_postal_code,disabled:c,placeholder:"Enter postal code"}),e(d,{label:"City",register:a,name:"delivery_city",error:o.delivery_city,disabled:c,placeholder:"Enter city"}),e(d,{label:"Country",register:a,name:"delivery_country",error:o.delivery_country,disabled:c,placeholder:"Enter country"})]})]}),s("div",{className:"flex justify-between items-center mt-5",children:[e(y,{type:"button",icon:"heroicons-outline:x",text:"Cancel",className:"btn-outline-dark",onClick:()=>p("/company/orders")}),e(y,{type:"submit",icon:"heroicons-outline:save",text:"Update Order",className:"btn-dark",isLoading:Q})]})]})]})};export{he as default};
