import{q as z,d as A,c as Q,m as J,r as S,a as e,y as W,C as w,j as l,I as j,B as i,Q as L,G as D}from"./index.075fb68b.js";import{T as x}from"./Textinput.595cc28f.js";import{b as H,d as K}from"./usersApiSlice.1760b12c.js";import{c as X,a as g,b as Y,u as Z,o as ee}from"./array.537130ac.js";const ae=X().shape({email:g().required("Email is required").email("Please enter a valid email address").max(255,"Email cannot exceed 255 characters"),name:g().required("Name is required").max(255,"Name cannot exceed 255 characters"),phone:g().nullable().max(20,"Phone number cannot exceed 20 characters"),password:g().nullable().transform(a=>a||null),password_confirmation:g().nullable().transform(a=>a||null).when("password",{is:a=>a&&a.length>0,then:a=>a.required("Please confirm your password").oneOf([Y("password"),null],"Passwords must match")})}),ne=()=>{var _;const{id:a}=z(),c=A(),V=Q(),N=J(t=>t.auth.user),v=S.exports.useRef(null),{data:r,isLoading:F,isError:q,error:b}=H(a),[I,{isLoading:P}]=K(),{register:d,handleSubmit:B,formState:{errors:m,isSubmitting:C},setError:G,setValue:$,watch:k,reset:U}=Z({resolver:ee(ae),mode:"onChange",defaultValues:{email:"",name:"",phone:"",password:"",password_confirmation:"",avatar:null}});S.exports.useEffect(()=>{var t,o,n,p,h,s;r&&(console.log("User data loaded:",r),U({email:r.email||"",password:"",password_confirmation:"",name:((t=r.user_profile)==null?void 0:t.name)||((o=r.userProfile)==null?void 0:o.name)||"",phone:((n=r.user_profile)==null?void 0:n.phone)||((p=r.userProfile)==null?void 0:p.phone)||"",avatar:((h=r.user_profile)==null?void 0:h.avatar)||((s=r.userProfile)==null?void 0:s.avatar)||null}))},[r,U]);const R=async t=>{const o=t.target.files[0];if(o){const n=new FileReader;n.onloadend=()=>{$("avatar",n.result)},n.readAsDataURL(o)}},M=()=>{v.current.click()},O=async t=>{var o,n,p,h;try{console.log("Submitting form with data:",t);const s={...t,role_id:r.role_id,id:a},f=await I(s).unwrap();L.success("User updated successfully"),N&&N.id===parseInt(a)&&V(D({name:t.name,phone:t.phone,avatar:((n=(o=f==null?void 0:f.data)==null?void 0:o.user_profile)==null?void 0:n.avatar)||t.avatar})),c("/company/users")}catch(s){console.error("Update failed",s),(p=s==null?void 0:s.data)!=null&&p.errors?Object.entries(s.data.errors).forEach(([f,T])=>{G(f,{type:"manual",message:T[0]})}):L.error(((h=s==null?void 0:s.data)==null?void 0:h.message)||"Failed to update user")}},u=k("avatar"),E=u?typeof u=="string"&&u.startsWith("data:")?u:`https://kolster-app.onlinewithyou.nl/${u}`:null,y=k();return F?e(W,{}):q?e(w,{children:l("div",{className:"flex flex-col items-center justify-center h-60",children:[e(j,{icon:"heroicons-outline:exclamation-circle",className:"text-danger-500 text-4xl mb-2"}),e("h3",{className:"text-xl font-medium text-slate-900",children:"Error Loading Data"}),e("p",{className:"text-sm text-slate-600 mt-1 mb-4",children:((_=b==null?void 0:b.data)==null?void 0:_.message)||"Could not load user information"}),e(i,{text:"Back to Users",icon:"heroicons-outline:arrow-left",className:"btn-primary",onClick:()=>c("/company/users")})]})}):l("div",{className:"space-y-5",children:[l("div",{className:"flex flex-wrap justify-between items-center",children:[e("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:"Edit User"}),l("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[e(i,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>c("/company/users")}),e(i,{icon:"heroicons-outline:eye",text:"View Details",className:"btn-outline-dark",onClick:()=>c(`/company/users/${a}`)})]})]}),l("form",{onSubmit:B(O),children:[e(w,{title:"User Information",children:l("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[e(x,{label:"Full Name *",type:"text",placeholder:"Enter full name",register:d,name:"name",error:m.name,defaultValue:y.name}),e(x,{label:"Email *",type:"email",placeholder:"Enter email address",register:d,name:"email",error:m.email,defaultValue:y.email}),e(x,{label:"Phone",type:"text",placeholder:"Enter phone number",register:d,name:"phone",error:m.phone,defaultValue:y.phone})]})}),l(w,{title:"Change Password",className:"mt-5",children:[l("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[e(x,{label:"New Password",type:"password",placeholder:"Leave blank to keep current password",register:d,name:"password",error:m.password}),e(x,{label:"Confirm New Password",type:"password",placeholder:"Confirm new password",register:d,name:"password_confirmation",error:m.password_confirmation})]}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Only fill in if you want to change the user's password."})]}),e(w,{title:"Profile Picture",className:"mt-5",children:l("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[e("div",{children:E?e("img",{src:E,alt:"Avatar Preview",className:"h-20 w-20 rounded-full object-cover"}):e("div",{className:"h-20 w-20 rounded-full bg-slate-200 flex items-center justify-center",children:e(j,{icon:"heroicons-outline:user",className:"text-3xl text-slate-400"})})}),l("div",{className:"flex-1",children:[e(i,{text:"Change Picture",icon:"heroicons-outline:upload",className:"btn-outline-dark",onClick:M}),e("input",{type:"file",ref:v,className:"hidden",accept:"image/*",onChange:R}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Supported formats: JPG, PNG, GIF (Max size: 2MB)"})]})]})}),l("div",{className:"flex justify-between items-center mt-5",children:[e(i,{type:"button",icon:"heroicons-outline:x",text:"Cancel",className:"btn-outline-dark",onClick:()=>c("/company/users")}),e(i,{type:"submit",icon:"heroicons-outline:save",text:"Update User",className:"btn-dark",isLoading:P||C,disabled:P||C})]})]})]})};export{ne as default};
