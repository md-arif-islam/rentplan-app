import{d as ae,r as f,j as s,a as e,B as m,C as w,I as B,Q as L}from"./index.075fb68b.js";import{R as z,T as I}from"./Textarea.242e9860.js";import{T as d}from"./Textinput.595cc28f.js";import{c as ie}from"./productsApiSlice.3bd2244e.js";import{c as G,a as u,d as o,f as $,u as se,g as ce,o as le}from"./array.537130ac.js";const ne=G().shape({name:u().required("Product name is required").max(255,"Product name cannot exceed 255 characters"),type:o().required("Product type is required").oneOf([0,1],"Invalid product type"),price:o().transform(t=>isNaN(t)||t===""?null:t).when("type",{is:0,then:()=>o().transform(t=>isNaN(t)||t===""?null:t).required("Price is required for simple products").typeError("Price must be a valid number").min(0,"Price cannot be negative"),otherwise:()=>o().nullable()}),stock:o().nullable().transform(t=>isNaN(t)||t===""?null:t).typeError("Stock must be a valid number or empty"),specifications:u().nullable(),woocommerce_product_id:o().nullable().transform(t=>isNaN(t)||t===""?null:t),variations:$().when("type",{is:1,then:()=>$().of(G().shape({id:o().nullable().transform(t=>isNaN(t)||t===""?null:t),variant_name:u().required("Variation name is required"),sku:u().nullable(),price:o().transform(t=>isNaN(t)||t===""?null:t).required("Price is required for variations").min(0,"Price cannot be negative"),stock:o().nullable().transform(t=>isNaN(t)||t===""?null:t),specifications:u().nullable(),attributes:u().nullable()})).min(1,"At least one variation is required for variable products"),otherwise:()=>$().nullable()})}),he=()=>{const t=ae(),[h,C]=f.exports.useState(0),q=f.exports.useRef(null),[g,M]=f.exports.useState([]),[O,{isLoading:J}]=ie(),{register:n,handleSubmit:K,control:W,formState:{errors:c,isSubmitting:Q},setError:S,setValue:N,watch:y}=se({resolver:le(ne),mode:"onChange",defaultValues:{name:"",type:0,price:"",stock:"",specifications:"",image_url:null,woocommerce_product_id:"",variations:[{variant_name:"",sku:"",price:"",stock:"",specifications:"",attributes:"",image_url:null}]}}),{fields:v,append:H,remove:X}=ce({control:W,name:"variations"});f.exports.useEffect(()=>{const a=y((r,{name:l,type:i})=>{l==="type"&&C(parseInt(r.type))});return()=>a.unsubscribe()},[y]),f.exports.useEffect(()=>{M(v.map(()=>({current:null})))},[v.length]);const Y=async a=>{const r=a.target.files[0];if(r){const l=new FileReader;l.onloadend=()=>{N("image_url",l.result)},l.readAsDataURL(r)}},Z=()=>{q.current.click()},D=(a,r)=>{const l=r.target.files[0];if(l){const i=new FileReader;i.onloadend=()=>{N(`variations.${a}.image_url`,i.result)},i.readAsDataURL(l)}},ee=a=>{g[a]&&g[a].current&&g[a].current.click()},te=()=>{H({variant_name:"",sku:"",price:"",stock:"",specifications:"",attributes:"",image_url:null})},re=async a=>{var r,l;try{if(a.type=parseInt(a.type),a.type===0){if(a.price===null||a.price===""){S("price",{type:"manual",message:"Price is required for simple products"});return}a.price=Number(a.price),a.stock=a.stock===null||a.stock===""?null:Number(a.stock),delete a.variations}else a.variations=a.variations.map(i=>({...i,price:i.price===null||i.price===""?0:Number(i.price),stock:i.stock===null||i.stock===""?null:Number(i.stock)}));await O(a).unwrap(),L.success("Product created successfully"),t("/company/products")}catch(i){console.error("Create failed",i),(r=i==null?void 0:i.data)!=null&&r.errors?Object.entries(i.data.errors).forEach(([p,b])=>{if(p.includes("variations.")){const[k,x,P]=p.split(".");S(`${k}[${x}].${P}`,{type:"manual",message:b[0]})}else S(p,{type:"manual",message:b[0]})}):L.error(((l=i==null?void 0:i.data)==null?void 0:l.message)||"Failed to create product")}},R=y("image_url"),_=y("variations");return s("div",{className:"space-y-5",children:[s("div",{className:"flex flex-wrap justify-between items-center",children:[e("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:"Create New Product"}),e(m,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>t("/company/products")})]}),s("form",{onSubmit:K(re),children:[s(w,{title:"Basic Information",children:[s("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5 mb-5",children:[e(d,{label:"Product Name *",type:"text",placeholder:"Enter product name",register:n,name:"name",error:c.name}),e(d,{label:"WooCommerce Product ID",type:"number",placeholder:"Enter WooCommerce ID (optional)",register:n,name:"woocommerce_product_id",error:c.woocommerce_product_id})]}),s("div",{className:"mb-5",children:[e("label",{className:"form-label",children:"Product Type *"}),s("div",{className:"flex items-center space-x-7 rtl:space-x-reverse",children:[e(z,{label:"Simple Product",name:"type",value:0,checked:h===0,onChange:()=>{N("type",0),C(0)},error:c.type}),e(z,{label:"Variable Product",name:"type",value:1,checked:h===1,onChange:()=>{N("type",1),C(1)},error:c.type})]}),c.type&&e("div",{className:"text-danger-500 text-sm mt-1",children:c.type.message})]}),h===0&&s("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[s("div",{children:[e(d,{label:"Price *",type:"number",step:"0.01",placeholder:"Enter price",register:n,name:"price",error:c.price}),c.price&&c.price.type==="typeError"&&e("div",{className:"text-danger-500 text-sm mt-1",children:"Please enter a valid price"}),!c.price&&h===0&&e("div",{className:"text-xs text-slate-500 mt-1",children:"Required for simple products"})]}),e(d,{label:"Stock",type:"number",placeholder:"Enter stock",register:n,name:"stock",error:c.stock})]})]}),e(w,{title:"Product Image",className:"mt-5",children:s("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[e("div",{children:R?e("img",{src:R,alt:"Product Preview",className:"h-32 w-32 object-contain border border-slate-200 rounded-lg p-1"}):e("div",{className:"h-32 w-32 rounded-lg bg-slate-100 flex items-center justify-center",children:e(B,{icon:"heroicons-outline:photograph",className:"text-3xl text-slate-400"})})}),s("div",{className:"flex-1",children:[e(m,{text:"Upload Image",icon:"heroicons-outline:upload",className:"btn-outline-dark",onClick:Z}),e("input",{type:"file",ref:q,className:"hidden",accept:"image/*",onChange:Y}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Supported formats: JPG, PNG, GIF (Max size: 2MB)"})]})]})}),s(w,{title:"Specifications",className:"mt-5",children:[e(I,{label:"Product Specifications",placeholder:"Enter product specifications",register:n,name:"specifications",error:c.specifications,className:"h-32"}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Enter product specifications in text or JSON format."})]}),h===1&&e(w,{title:"Product Variations",className:"mt-5",children:s("div",{className:"space-y-8",children:[v.map((a,r)=>{var l,i,p,b,k,x,P,V,j,F,U,T,A;return s("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[s("div",{className:"flex justify-between items-center mb-4",children:[s("h3",{className:"text-lg font-medium",children:["Variation #",r+1]}),v.length>1&&e(m,{icon:"heroicons-outline:trash",className:"btn-outline-danger h-8 w-8 p-0",onClick:()=>X(r)})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e(d,{label:"Variation Name *",type:"text",placeholder:"E.g. Small, Red, etc.",register:n,name:`variations.${r}.variant_name`,error:(i=(l=c.variations)==null?void 0:l[r])==null?void 0:i.variant_name}),e(d,{label:"SKU",type:"text",placeholder:"Enter SKU",register:n,name:`variations.${r}.sku`,error:(b=(p=c.variations)==null?void 0:p[r])==null?void 0:b.sku}),e(d,{label:"Price *",type:"number",step:"0.01",placeholder:"Enter price",register:n,name:`variations.${r}.price`,error:(x=(k=c.variations)==null?void 0:k[r])==null?void 0:x.price}),e(d,{label:"Stock",type:"number",placeholder:"Enter stock",register:n,name:`variations.${r}.stock`,error:(V=(P=c.variations)==null?void 0:P[r])==null?void 0:V.stock})]}),s("div",{className:"grid grid-cols-1 gap-4 mb-4",children:[e(I,{label:"Attributes",placeholder:"Enter attributes (e.g. Color: Red, Size: Small)",register:n,name:`variations.${r}.attributes`,error:(F=(j=c.variations)==null?void 0:j[r])==null?void 0:F.attributes}),e(I,{label:"Specifications",placeholder:"Enter specifications",register:n,name:`variations.${r}.specifications`,error:(T=(U=c.variations)==null?void 0:U[r])==null?void 0:T.specifications})]}),s("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[e("div",{children:_&&((A=_[r])==null?void 0:A.image_url)?e("img",{src:_[r].image_url,alt:`Variation ${r+1}`,className:"h-20 w-20 object-contain border border-slate-200 rounded-lg p-1"}):e("div",{className:"h-20 w-20 rounded-lg bg-slate-100 flex items-center justify-center",children:e(B,{icon:"heroicons-outline:photograph",className:"text-xl text-slate-400"})})}),s("div",{className:"flex-1",children:[e(m,{text:"Upload Image",icon:"heroicons-outline:upload",className:"btn-outline-dark btn-sm",onClick:()=>ee(r)}),e("input",{type:"file",ref:E=>{g[r]={current:E}},className:"hidden",accept:"image/*",onChange:E=>D(r,E)})]})]})]},a.id)}),e("div",{className:"flex justify-center",children:e(m,{text:"Add Variation",icon:"heroicons-outline:plus",className:"btn-secondary",onClick:te})})]})}),s("div",{className:"flex justify-between items-center mt-5",children:[e(m,{type:"button",icon:"heroicons-outline:x",text:"Cancel",className:"btn-outline-dark",onClick:()=>t("/company/products")}),e(m,{type:"submit",icon:"heroicons-outline:plus",text:"Create Product",className:"btn-dark",isLoading:J||Q})]})]})]})};export{he as default};
