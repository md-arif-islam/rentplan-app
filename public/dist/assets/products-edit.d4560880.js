import{q as me,d as pe,r as b,a as e,y as ue,C as x,j as s,I as R,B as d,Q as J}from"./index.075fb68b.js";import{R as K,T as F}from"./Textarea.242e9860.js";import{T as p}from"./Textinput.595cc28f.js";import{b as he,d as be}from"./productsApiSlice.3bd2244e.js";import{c as Q,a as g,d as m,f as U,u as ge,g as fe,o as Ne}from"./array.537130ac.js";const ye=Q().shape({name:g().required("Product name is required").max(255,"Product name cannot exceed 255 characters"),type:m().required("Product type is required").oneOf([0,1],"Invalid product type"),price:m().transform(a=>isNaN(a)||a===""?null:a).when("type",{is:0,then:()=>m().transform(a=>isNaN(a)||a===""?null:a).required("Price is required for simple products").typeError("Price must be a valid number").min(0,"Price cannot be negative"),otherwise:()=>m().nullable()}),stock:m().nullable().transform(a=>isNaN(a)||a===""?null:a).typeError("Stock must be a valid number or empty"),specifications:g().nullable(),woocommerce_product_id:m().nullable().transform(a=>isNaN(a)||a===""?null:a),variations:U().when("type",{is:1,then:()=>U().of(Q().shape({id:m().nullable().transform(a=>isNaN(a)||a===""?null:a),variant_name:g().required("Variation name is required"),sku:g().nullable(),price:m().transform(a=>isNaN(a)||a===""?null:a).required("Price is required for variations").min(0,"Price cannot be negative"),stock:m().nullable().transform(a=>isNaN(a)||a===""?null:a),specifications:g().nullable(),attributes:g().nullable()})).min(1,"At least one variation is required for variable products"),otherwise:()=>U().nullable()})}),_e=()=>{var A;const{id:a}=me(),f=pe(),[N,v]=b.exports.useState(0),L=b.exports.useRef(null),[P,H]=b.exports.useState([]),{data:l,isLoading:X,isError:Y,error:I}=he(a),[Z,{isLoading:D}]=be(),{register:n,handleSubmit:ee,control:te,formState:{errors:c,isSubmitting:re},setError:V,setValue:w,watch:_,reset:T}=ge({resolver:Ne(ye),mode:"onChange",defaultValues:{name:"",type:0,price:"",stock:"",specifications:"",image_url:null,woocommerce_product_id:"",variations:[]}}),{fields:C,append:ae,remove:ie,replace:j}=fe({control:te,name:"variations"});b.exports.useEffect(()=>{l&&(T({name:l.name||"",type:l.type||0,price:l.price||"",stock:l.stock||"",specifications:l.specifications||"",image_url:l.image_url||null,woocommerce_product_id:l.woocommerce_product_id||""}),v(l.type),l.type===1&&l.variations&&l.variations.length>0?j(l.variations.map(t=>({id:t.id,variant_name:t.variant_name||"",sku:t.sku||"",price:t.price||"",stock:t.stock||"",specifications:t.specifications||"",attributes:t.attributes||"",image_url:t.image_url||null}))):l.type===1&&j([{variant_name:"",sku:"",price:"",stock:"",specifications:"",attributes:"",image_url:null}]))},[l,T,j]),b.exports.useEffect(()=>{const t=_((r,{name:o})=>{o==="type"&&v(parseInt(r.type))});return()=>t.unsubscribe()},[_]),b.exports.useEffect(()=>{H(C.map(()=>({current:null})))},[C.length]);const se=async t=>{const r=t.target.files[0];if(r){const o=new FileReader;o.onloadend=()=>{w("image_url",o.result)},o.readAsDataURL(r)}},ce=()=>{L.current.click()},le=(t,r)=>{const o=r.target.files[0];if(o){const i=new FileReader;i.onloadend=()=>{w(`variations.${t}.image_url`,i.result)},i.readAsDataURL(o)}},oe=t=>{P[t]&&P[t].current&&P[t].current.click()},ne=()=>{ae({variant_name:"",sku:"",price:"",stock:"",specifications:"",attributes:"",image_url:null})},de=async t=>{var r,o;try{if(t.type=parseInt(t.type),t.type===0){if(t.price===null||t.price===""){V("price",{type:"manual",message:"Price is required for simple products"});return}t.price=Number(t.price),t.stock=t.stock===null||t.stock===""?null:Number(t.stock),delete t.variations}else t.variations=t.variations.map(i=>({...i,id:i.id===null||i.id===""?null:Number(i.id),price:i.price===null||i.price===""?0:Number(i.price),stock:i.stock===null||i.stock===""?null:Number(i.stock)}));await Z({id:a,...t}).unwrap(),J.success("Product updated successfully"),f("/company/products")}catch(i){console.error("Update failed",i),(r=i==null?void 0:i.data)!=null&&r.errors?Object.entries(i.data.errors).forEach(([h,k])=>{if(h.includes("variations.")){const[E,S,$]=h.split(".");V(`${E}[${S}].${$}`,{type:"manual",message:k[0]})}else V(h,{type:"manual",message:k[0]})}):J.error(((o=i==null?void 0:i.data)==null?void 0:o.message)||"Failed to update product")}},y=_("image_url"),u=_("variations");return X?e(ue,{}):Y?e(x,{children:s("div",{className:"flex flex-col items-center justify-center h-60",children:[e(R,{icon:"heroicons-outline:exclamation-circle",className:"text-danger-500 text-4xl mb-2"}),e("h3",{className:"text-xl font-medium text-slate-900",children:"Error Loading Product"}),e("p",{className:"text-sm text-slate-600 mt-1 mb-4",children:((A=I==null?void 0:I.data)==null?void 0:A.message)||"Could not load product information"}),e(d,{text:"Back to Products",icon:"heroicons-outline:arrow-left",className:"btn-primary",onClick:()=>f("/company/products")})]})}):s("div",{className:"space-y-5",children:[s("div",{className:"flex flex-wrap justify-between items-center",children:[e("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:"Edit Product"}),s("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[e(d,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>f("/company/products")}),e(d,{icon:"heroicons-outline:eye",text:"View Details",className:"btn-outline-dark",onClick:()=>f(`/company/products/${a}`)})]})]}),s("form",{onSubmit:ee(de),children:[s(x,{title:"Basic Information",children:[s("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5 mb-5",children:[e(p,{label:"Product Name *",type:"text",placeholder:"Enter product name",register:n,name:"name",error:c.name}),e(p,{label:"WooCommerce Product ID",type:"number",placeholder:"Enter WooCommerce ID (optional)",register:n,name:"woocommerce_product_id",error:c.woocommerce_product_id})]}),s("div",{className:"mb-5",children:[e("label",{className:"form-label",children:"Product Type *"}),s("div",{className:"flex items-center space-x-7 rtl:space-x-reverse",children:[e(K,{label:"Simple Product",name:"type",value:0,checked:N===0,onChange:()=>{w("type",0),v(0)},error:c.type}),e(K,{label:"Variable Product",name:"type",value:1,checked:N===1,onChange:()=>{w("type",1),v(1)},error:c.type})]}),c.type&&e("div",{className:"text-danger-500 text-sm mt-1",children:c.type.message})]}),N===0&&s("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[s("div",{children:[e(p,{label:"Price *",type:"number",step:"0.01",placeholder:"Enter price",register:n,name:"price",error:c.price}),c.price&&c.price.type==="typeError"&&e("div",{className:"text-danger-500 text-sm mt-1",children:"Please enter a valid price"}),!c.price&&N===0&&e("div",{className:"text-xs text-slate-500 mt-1",children:"Required for simple products"})]}),e(p,{label:"Stock",type:"number",placeholder:"Enter stock",register:n,name:"stock",error:c.stock})]})]}),e(x,{title:"Product Image",className:"mt-5",children:s("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[e("div",{children:y?typeof y=="string"&&y.startsWith("data:")?e("img",{src:y,alt:"Product Preview",className:"h-32 w-32 object-contain border border-slate-200 rounded-lg p-1"}):e("img",{src:`https://kolster-app.onlinewithyou.nl/${y}`,alt:"Product Preview",className:"h-32 w-32 object-contain border border-slate-200 rounded-lg p-1"}):e("div",{className:"h-32 w-32 rounded-lg bg-slate-100 flex items-center justify-center",children:e(R,{icon:"heroicons-outline:photograph",className:"text-3xl text-slate-400"})})}),s("div",{className:"flex-1",children:[e(d,{text:"Change Image",icon:"heroicons-outline:upload",className:"btn-outline-dark",onClick:ce}),e("input",{type:"file",ref:L,className:"hidden",accept:"image/*",onChange:se}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Supported formats: JPG, PNG, GIF (Max size: 2MB)"})]})]})}),s(x,{title:"Specifications",className:"mt-5",children:[e(F,{label:"Product Specifications",placeholder:"Enter product specifications",register:n,name:"specifications",error:c.specifications,className:"h-32"}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Enter product specifications in text or JSON format."})]}),N===1&&e(x,{title:"Product Variations",className:"mt-5",children:s("div",{className:"space-y-8",children:[C.map((t,r)=>{var o,i,h,k,E,S,$,B,G,W,z,M,O;return s("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg p-4",children:[s("div",{className:"flex justify-between items-center mb-4",children:[s("h3",{className:"text-lg font-medium",children:["Variation #",r+1]}),C.length>1&&e(d,{icon:"heroicons-outline:trash",className:"btn-outline-danger h-8 w-8 p-0",onClick:()=>ie(r)})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.id&&e("input",{type:"hidden",...n(`variations.${r}.id`),defaultValue:t.id}),e(p,{label:"Variation Name *",type:"text",placeholder:"E.g. Small, Red, etc.",register:n,name:`variations.${r}.variant_name`,error:(i=(o=c.variations)==null?void 0:o[r])==null?void 0:i.variant_name}),e(p,{label:"SKU",type:"text",placeholder:"Enter SKU",register:n,name:`variations.${r}.sku`,error:(k=(h=c.variations)==null?void 0:h[r])==null?void 0:k.sku}),e(p,{label:"Price *",type:"number",step:"0.01",placeholder:"Enter price",register:n,name:`variations.${r}.price`,error:(S=(E=c.variations)==null?void 0:E[r])==null?void 0:S.price}),e(p,{label:"Stock",type:"number",placeholder:"Enter stock",register:n,name:`variations.${r}.stock`,error:(B=($=c.variations)==null?void 0:$[r])==null?void 0:B.stock})]}),s("div",{className:"grid grid-cols-1 gap-4 mb-4",children:[e(F,{label:"Attributes",placeholder:"Enter attributes (e.g. Color: Red, Size: Small)",register:n,name:`variations.${r}.attributes`,error:(W=(G=c.variations)==null?void 0:G[r])==null?void 0:W.attributes}),e(F,{label:"Specifications",placeholder:"Enter specifications",register:n,name:`variations.${r}.specifications`,error:(M=(z=c.variations)==null?void 0:z[r])==null?void 0:M.specifications})]}),s("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[e("div",{children:u&&((O=u[r])==null?void 0:O.image_url)?typeof u[r].image_url=="string"&&u[r].image_url.startsWith("data:")?e("img",{src:u[r].image_url,alt:`Variation ${r+1}`,className:"h-20 w-20 object-contain border border-slate-200 rounded-lg p-1"}):e("img",{src:`https://kolster-app.onlinewithyou.nl/${u[r].image_url}`,alt:`Variation ${r+1}`,className:"h-20 w-20 object-contain border border-slate-200 rounded-lg p-1"}):e("div",{className:"h-20 w-20 rounded-lg bg-slate-100 flex items-center justify-center",children:e(R,{icon:"heroicons-outline:photograph",className:"text-xl text-slate-400"})})}),s("div",{className:"flex-1",children:[e(d,{text:"Change Image",icon:"heroicons-outline:upload",className:"btn-outline-dark btn-sm",onClick:()=>oe(r)}),e("input",{type:"file",ref:q=>{P[r]={current:q}},className:"hidden",accept:"image/*",onChange:q=>le(r,q)})]})]})]},t.id)}),e("div",{className:"flex justify-center",children:e(d,{text:"Add Variation",icon:"heroicons-outline:plus",className:"btn-secondary",onClick:ne})})]})}),s("div",{className:"flex justify-between items-center mt-5",children:[e(d,{type:"button",icon:"heroicons-outline:x",text:"Cancel",className:"btn-outline-dark",onClick:()=>f("/company/products")}),e(d,{type:"submit",icon:"heroicons-outline:save",text:"Update Product",className:"btn-dark",isLoading:D||re})]})]})]})};export{_e as default};
