import{S as U}from"./Table.d473f6a6.js";import{d as J,r as v,a as e,j as l,B as h,C as f,Q as b}from"./index.075fb68b.js";import{S as g}from"./Select.3e0ab40e.js";import{T as i}from"./Textinput.595cc28f.js";import{u as K}from"./customersApiSlice.4a4014f7.js";import{c as R}from"./ordersApiSlice.209ba1fa.js";import{u as X}from"./productsApiSlice.3bd2244e.js";import{c as Y,d as N,e as D,b as Z,a as c,u as ee,o as re}from"./array.537130ac.js";const te=Y().shape({customer_id:N().transform(o=>isNaN(o)||o===""?void 0:o).required("Customer is required").typeError("Please select a customer"),product_id:N().transform(o=>isNaN(o)||o===""?void 0:o).required("Product is required").typeError("Please select a product"),start_date:D().required("Start date is required"),end_date:D().required("End date is required").min(Z("start_date"),"End date must be after start date"),order_status:c().required("Order status is required"),invoice_street:c().nullable(),invoice_postal_code:c().nullable(),invoice_house_number:c().nullable(),invoice_city:c().nullable(),invoice_country:c().nullable(),delivery_street:c().nullable(),delivery_postal_code:c().nullable(),delivery_house_number:c().nullable(),delivery_city:c().nullable(),delivery_country:c().nullable(),woocommerce_order_id:N().nullable().transform(o=>isNaN(o)||o===""?null:Number(o))}),_e=()=>{var P,w,k;const o=J(),[$,{isLoading:I}]=R(),[j,oe]=v.exports.useState(""),[L,ae]=v.exports.useState(""),[d,T]=v.exports.useState(!0),{data:p,isLoading:A}=K({search:j,perPage:100}),{data:y,isLoading:B}=X({search:L,perPage:100}),{register:s,handleSubmit:H,formState:{errors:t},setValue:a,watch:n}=ee({resolver:re(te),mode:"onChange",defaultValues:{customer_id:"",product_id:"",start_date:new Date().toISOString().split("T")[0],end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],order_status:"pending",invoice_street:"",invoice_postal_code:"",invoice_house_number:"",invoice_city:"",invoice_country:"",delivery_street:"",delivery_postal_code:"",delivery_house_number:"",delivery_city:"",delivery_country:"",woocommerce_order_id:""}}),M=n("customer_id"),C=n("invoice_street"),x=n("invoice_postal_code"),S=n("invoice_house_number"),E=n("invoice_city"),O=n("invoice_country"),_=(P=p==null?void 0:p.data)==null?void 0:P.find(r=>r.id===parseInt(M));v.exports.useEffect(()=>{_&&(a("invoice_street",_.street||""),a("invoice_postal_code",_.postal_code||""),a("invoice_house_number",_.house_number||""),a("invoice_city",_.city||""),a("invoice_country",_.country||""))},[_,a]),v.exports.useEffect(()=>{d&&(a("delivery_street",C),a("delivery_postal_code",x),a("delivery_house_number",S),a("delivery_city",E),a("delivery_country",O))},[d,C,x,S,E,O,a]);const Q=[{value:"pending",label:"Pending"},{value:"processing",label:"Processing"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],F=async r=>{var u,q;try{if(!r.customer_id||isNaN(Number(r.customer_id))){b.error("Please select a valid customer");return}if(!r.product_id||isNaN(Number(r.product_id))){b.error("Please select a valid product");return}r.customer_id=Number(r.customer_id),r.product_id=Number(r.product_id),await $(r).unwrap(),b.success("Order created successfully"),o("/company/orders")}catch(m){console.error("Create failed",m),(u=m==null?void 0:m.data)!=null&&u.errors?Object.entries(m.data.errors).forEach(([W,z])=>{b.error(`${W}: ${z[0]}`)}):b.error(((q=m==null?void 0:m.data)==null?void 0:q.message)||"Failed to create order")}};if(A||B)return e(U,{count:4});const G=((w=p==null?void 0:p.data)==null?void 0:w.map(r=>({value:r.id,label:`${r.first_name} ${r.last_name} (${r.email||"No email"})`})))||[],V=((k=y==null?void 0:y.data)==null?void 0:k.map(r=>({value:r.id,label:`${r.name}`})))||[];return l("div",{className:"space-y-5",children:[l("div",{className:"flex flex-wrap justify-between items-center",children:[e("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:"Create New Order"}),e(h,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>o("/company/orders")})]}),l("form",{onSubmit:H(F),children:[e(f,{title:"Order Information",children:l("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[l("div",{children:[e("label",{className:"form-label",children:"Customer *"}),e(g,{options:G,value:n("customer_id"),onChange:r=>{const u=r.target.value;a("customer_id",u?Number(u):"")},error:t.customer_id,noOptionsMessage:()=>"No customers found"}),t.customer_id&&e("div",{className:"text-danger-500 text-sm mt-1",children:t.customer_id.message})]}),l("div",{children:[e("label",{className:"form-label",children:"Product *"}),e(g,{options:V,value:n("product_id"),onChange:r=>{const u=r.target.value;a("product_id",u?Number(u):"")},error:t.product_id,noOptionsMessage:()=>"No products found"}),t.product_id&&e("div",{className:"text-danger-500 text-sm mt-1",children:t.product_id.message})]}),e(i,{label:"Start Date *",type:"date",register:s,name:"start_date",error:t.start_date,placeholder:"Select start date"}),e(i,{label:"End Date *",type:"date",register:s,name:"end_date",error:t.end_date,placeholder:"Select end date"}),l("div",{children:[e("label",{className:"form-label",children:"Status *"}),e(g,{options:Q,value:n("order_status"),onChange:r=>a("order_status",r.target.value),error:t.order_status})]}),e(i,{label:"WooCommerce Order ID (Optional)",type:"number",register:s,name:"woocommerce_order_id",error:t.woocommerce_order_id,placeholder:"Enter WooCommerce ID if applicable"})]})}),e(f,{title:"Invoice Address",className:"mt-5",children:l("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e(i,{label:"Street",register:s,name:"invoice_street",error:t.invoice_street,placeholder:"Enter street name"}),e(i,{label:"House Number",register:s,name:"invoice_house_number",error:t.invoice_house_number,placeholder:"Enter house number"}),e(i,{label:"Postal Code",register:s,name:"invoice_postal_code",error:t.invoice_postal_code,placeholder:"Enter postal code"}),e(i,{label:"City",register:s,name:"invoice_city",error:t.invoice_city,placeholder:"Enter city"}),e(i,{label:"Country",register:s,name:"invoice_country",error:t.invoice_country,placeholder:"Enter country"})]})}),l(f,{title:"Delivery Address",className:"mt-5",children:[e("div",{className:"mb-5",children:l("label",{className:"inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"form-checkbox rounded text-primary-500 border-slate-300",checked:d,onChange:()=>T(!d)}),e("span",{className:"text-slate-500 dark:text-slate-400 text-sm ml-2",children:"Same as invoice address"})]})}),l("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e(i,{label:"Street",register:s,name:"delivery_street",error:t.delivery_street,disabled:d,placeholder:"Enter street name"}),e(i,{label:"House Number",register:s,name:"delivery_house_number",error:t.delivery_house_number,disabled:d,placeholder:"Enter house number"}),e(i,{label:"Postal Code",register:s,name:"delivery_postal_code",error:t.delivery_postal_code,disabled:d,placeholder:"Enter postal code"}),e(i,{label:"City",register:s,name:"delivery_city",error:t.delivery_city,disabled:d,placeholder:"Enter city"}),e(i,{label:"Country",register:s,name:"delivery_country",error:t.delivery_country,disabled:d,placeholder:"Enter country"})]})]}),l("div",{className:"flex justify-between items-center mt-5",children:[e(h,{type:"button",icon:"heroicons-outline:x",text:"Cancel",className:"btn-outline-dark",onClick:()=>o("/company/orders")}),e(h,{type:"submit",icon:"heroicons-outline:plus",text:"Create Order",className:"btn-dark",isLoading:I})]})]})]})};export{_e as default};
