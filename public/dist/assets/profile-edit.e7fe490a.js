import{q as Z,d as ee,c as ae,m as te,t as se,v as re,w as oe,x as ne,r as m,a as e,C as f,y as ie,j as l,B as u,I as le,e as ce,Q as F}from"./index.075fb68b.js";import{T as h}from"./Textinput.595cc28f.js";const pe=()=>{var U,A;const{id:p}=Z(),w=ee(),S=ae(),y=te(a=>a.auth.user),_=((U=y==null?void 0:y.role)==null?void 0:U.name)||"",c=_==="super_admin",k=_==="company_admin",{data:$,isLoading:D,error:R}=se(p,{skip:!c||!p}),{data:I,isLoading:V,error:B}=re(p,{skip:!k||!p}),[Q,{isLoading:G}]=oe(),[M,{isLoading:T}]=ne(),d=c?$:I,q=c?D:V,g=c?R:B,z=c?G:T,x=c?"/admin":"/company",[t,v]=m.exports.useState({first_name:"",last_name:"",phone:"",avatar:null}),[o,O]=m.exports.useState({password:"",password_confirmation:""}),[W,C]=m.exports.useState(null),[H,N]=m.exports.useState(null),L=m.exports.useRef(null),J=async a=>{const s=a.target.files[0];if(s){const r=new FileReader;r.onloadend=()=>{v({...t,avatar:r.result})},r.readAsDataURL(s)}},K=()=>{L.current.click()};m.exports.useEffect(()=>{if(d){let a="",s="";if(d.name){const r=d.name.split(" ");a=r[0]||"",s=r.slice(1).join(" ")||""}v({first_name:a,last_name:s,phone:d.phone||"",avatar:d.avatar||null})}},[d]);const b=a=>{const{name:s,value:r}=a.target;v({...t,[s]:r})},E=a=>{const{name:s,value:r}=a.target;O({...o,[s]:r}),s==="password"&&C(null),s==="password_confirmation"&&N(null)},X=()=>{let a=!0;return o.password&&o.password.length<8&&(C("Password must be at least 8 characters"),a=!1),o.password!==o.password_confirmation&&(N("Passwords do not match"),a=!1),a},Y=async a=>{var s,r;a.preventDefault();try{const n=`${t.first_name} ${t.last_name}`.trim(),i={id:p,name:n,phone:t.phone,avatar:t.avatar};if(o.password){if(!X())return;i.password=o.password,i.password_confirmation=o.password_confirmation}let P;c?P=await Q(i).unwrap():k&&(P=await M(i).unwrap()),S(ce(P.data||P)),F.success("Profile updated successfully"),w(`${x}/profile`)}catch(n){if(console.error("Profile update error:",n),(s=n==null?void 0:n.data)!=null&&s.errors){const i=n.data.errors;i.password&&C(i.password[0]),i.password_confirmation&&N(i.password_confirmation[0])}else F.error(((r=n==null?void 0:n.data)==null?void 0:r.message)||"Failed to update profile")}},j=t.avatar?typeof t.avatar=="string"?t.avatar.startsWith("data:")?t.avatar:`https://kolster-app.onlinewithyou.nl/${t.avatar}`:URL.createObjectURL(t.avatar):null;return q?e(f,{children:e(ie,{})}):g?e(f,{children:l("div",{className:"flex flex-col items-center justify-center h-60",children:[e("h3",{className:"text-xl font-medium text-slate-900",children:"Error Loading Data"}),e("p",{className:"text-sm text-slate-600 mt-1 mb-4",children:((A=g==null?void 0:g.data)==null?void 0:A.message)||"Could not load profile information"}),e(u,{text:"Back to Profile",icon:"heroicons-outline:arrow-left",className:"btn-primary",onClick:()=>w(`${x}/profile`)})]})}):l("div",{className:"space-y-5",children:[l("div",{className:"flex flex-wrap justify-between items-center",children:[e("h4",{className:"font-medium lg:text-2xl text-xl capitalize text-slate-900 inline-block ltr:pr-4 rtl:pl-4",children:"Edit Profile"}),e(u,{icon:"heroicons-outline:arrow-left",text:"Back",className:"btn-outline-dark",onClick:()=>w(`${x}/profile`)})]}),l("form",{onSubmit:Y,children:[e(f,{title:"Personal Information",children:l("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[e(h,{label:"First Name",type:"text",placeholder:"Enter first name",defaultValue:t.first_name,onChange:b}),e(h,{label:"Last Name",type:"text",placeholder:"Enter last name",defaultValue:t.last_name,onChange:b}),e(h,{label:"Phone",type:"text",placeholder:"Enter phone",defaultValue:t.phone,onChange:b})]})}),l(f,{title:"Change Password",className:"mt-5",children:[l("div",{className:"grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-5",children:[e(h,{label:"New Password",type:"password",placeholder:"Enter new password",defaultValue:o.password,onChange:E,error:W}),e(h,{label:"Confirm Password",type:"password",placeholder:"Confirm new password",defaultValue:o.password_confirmation,onChange:E,error:H})]}),e("p",{className:"text-xs text-slate-500 mt-2",children:"Leave blank if you don't want to change your password. Password must be at least 8 characters."})]}),e(f,{title:"Profile Picture",className:"mt-5",children:l("div",{className:"flex items-center space-x-4 rtl:space-x-reverse",children:[j?e("img",{src:j,alt:"Profile Preview",className:"h-20 w-20 rounded-full object-cover"}):e("div",{className:"h-20 w-20 rounded-full bg-slate-200 flex items-center justify-center",children:e(le,{icon:"heroicons-outline:user",className:"text-4xl text-slate-500"})}),e(u,{text:"Upload Picture",icon:"heroicons-outline:upload",className:"btn-outline-dark",onClick:K}),e("input",{type:"file",ref:L,className:"hidden",accept:"image/*",onChange:J})]})}),l("div",{className:"flex justify-between items-center mt-5",children:[e(u,{type:"button",icon:"heroicons-outline:arrow-left",text:"Cancel",className:"btn-outline-dark",onClick:()=>w(`${x}/profile`)}),e(u,{type:"submit",icon:"heroicons-outline:save",text:"Save Changes",className:"btn-dark",isLoading:z})]})]})]})};export{pe as default};
